<div id="fb-root"></div>
<script src="//connect.facebook.net/en_US/all.js"></script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '138283156235665', // App ID
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      oauth      : true, // enable OAuth 2.0
      xfbml      : true  // parse XFBML
    });

    // Additional initialization code here
  };

  // Load the SDK Asynchronously
  (function(d){
     var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     d.getElementsByTagName('head')[0].appendChild(js);
   }(document));
</script>

<div data-role="content">
  <p class="user-home heading">Your Stats</p>
  <div class="ui-body-d ui-body" data-role="navbar">
    <ul>
      <li>
        <div class="user-home stats number"><span><%= current_user.total_problems_solved %></span></div>
        <div class="user-home stats text"><span>problems</span></div>
      </li>
      <li>
        <div class="user-home stats number"><span>0</span></div>
        <div class="user-home stats text"><span>routes</span></div>
      </li>
      <li>
        <div class="user-home stats number"><span>1</span></div>
        <div class="user-home stats text"><span>gyms</span></div>
      </li>
      <li>
        <div class="user-home stats number"><span>0<span></div>
        <div class="user-home stats text"><span>feet</span></div>
      </li>
    </ul>
  </div><!-- /navbar -->
  
  <% if @latest_session %>
  <p class="user-home heading">Your Last Climbs</p>
  <span class="session-sparkline"><%= @latest_session.sparkline_data %></span>
  <script type="text/javascript">
    $(function() { 
      $('.session-sparkline').sparkline('html', {
        type:'bar', barWidth:16, colorMap:["hsl(120,100%,40%)","hsl(113,100%,40%)", "hsl(106,100%,40%)", "hsl(99,100%,40%)", "hsl(92,100%,40%)", "hsl(85,100%,40%)", "hsl(78,100%,40%)", "hsl(71,100%,40%)", "hsl(64,100%,40%)", "hsl(57,100%,40%)", "hsl(50,100%,40%)", "hsl(43,100%,40%)", "hsl(36,100%,40%)", "hsl(29,100%,40%)", "hsl(22,100%,40%)", "hsl(15,100%,40%)", "hsl(8,100%,40%)"]
      });
    });

    $('#mainPage').live('pageshow', function() {
      // Go ahead and draw the now-visible sparkline tags
      $.sparkline_display_visible();
    });
  </script>
  <a id="test-button" rel="external" onclick="publishClimbingSession(); return false" data-role="button" href="">Post to Facebook</a>
  <script>
    function publishClimbingSession() {
      // https://developers.facebook.com/docs/reference/dialogs/feed/
      var obj = {
        method: 'feed',
        link: <%= "'#{root_url}'" %>,
        picture: <%= "'" + image_url("fb-post-icon.jpg") + "'" %>,
        name: <%= "'I just climbed " + pluralize(@latest_session.problem_count, "problem") + " at " + @latest_session.gym_name + "'" %>,
        description: <%= "'and I maxed out on a #{@latest_session.hardest_problem_diff} problem'" %>,
        };

      function callback(response) {
        // do something
      }

      FB.ui(obj, callback);
    };
  </script>
  <% end %>

</div>

<div data-role="content">
  <ul data-role="listview">
    
    <% unless @latest_gym.nil? %>
      <li><%= link_to "Last seen at #{@latest_gym.name}", @latest_gym %></li>
    <% end %>  
    
    <li><%= link_to 'Find a nearby gym', gyms_path, :"data-prefetch" => true %></li>
    
    <% if current_user.try(:admin?) %>
      <li><%= link_to 'Add a new wall (Admin only)', new_wall_path %></li>
    <% end %>
  
  </ul>
</div>
